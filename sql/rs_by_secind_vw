--
-- finds the median of each sector and industry group to provide and determine relative strength
--
CREATE OR REPLACE FORCE VIEW rs_by_secind_vw (SECID, INDNAME, VPRICEM001, VPRICEM002, VPRICEM003, VPRICEM004, VPRICEM005, VPRICEM006, VPRICEM007, VPRICEM008, VPRICEM009, VPRICEM010, VPRICEM011, VPRICEM012, VPRICEM013, VPRICEM014, VPRICEM015, VPRICEM016, VPRICEM017, VPRICEM018, VPRICEM019, VPRICEM020, VPRICEM021, VPRICEM022, VPRICEM023, VPRICEM024, VPRICEM025, VPRICEM026, VPRICEM027, VPRICEM028, VPRICEM029, VPRICEM030, VPRICEM031, VPRICEM032, VPRICEM033, VPRICEM034, VPRICEM035, VPRICEM036, VPRICEM037, VPRICEM038, VPRICEM039, VPRICEM040, VPRICEM041, VPRICEM042, VPRICEM043, VPRICEM044, VPRICEM045, VPRICEM046, VPRICEM047, VPRICEM048, VPRICEM049, VPRICEM050, VPRICEM051, VPRICEM052, VPRICEM053, VPRICEM054, VPRICEM055, VPRICEM056, VPRICEM057, VPRICEM058, VPRICEM059, VPRICEM060, VPRICEM061, VPRICEM062, VPRICEM063, VPRICEM064, VPRICEM065, VPRICEM066, VPRICEM067, VPRICEM068, VPRICEM069, VPRICEM070, VPRICEM071, VPRICEM072, VPRICEM073, VPRICEM074, VPRICEM075, VPRICEM076, VPRICEM077, VPRICEM078, VPRICEM079, VPRICEM080, VPRICEM081, VPRICEM082, VPRICEM083, VPRICEM084, VPRICEM085, VPRICEM086, VPRICEM087, VPRICEM088, VPRICEM089, VPRICEM090, VPRICEM091, VPRICEM092, VPRICEM093, VPRICEM094, VPRICEM095, VPRICEM096, VPRICEM097, VPRICEM098, VPRICEM099, VPRICEM100, VPRICEM101, VPRICEM102, VPRICEM103, VPRICEM104, VPRICEM105, VPRICEM106, VPRICEM107, VPRICEM108, VPRICEM109, VPRICEM110, VPRICEM111, VPRICEM112, VPRICEM113, VPRICEM114, VPRICEM115, VPRICEM116, VPRICEM117, VPRICEM118, VPRICEM119) AS 
  SELECT 
  secid, 
  indname,
  vpricem001,
  vpricem002,
  vpricem003,
  vpricem004,
  vpricem005,
  vpricem006,
  vpricem007,
  vpricem008,
  vpricem009,
  vpricem010,
  vpricem011,
  vpricem012,
  vpricem013,
  vpricem014,
  vpricem015,
  vpricem016,
  vpricem017,
  vpricem018,
  vpricem019,
  vpricem020,
  vpricem021,
  vpricem022,
  vpricem023,
  vpricem024,
  vpricem025,
  vpricem026,
  vpricem027,
  vpricem028,
  vpricem029,
  vpricem030,
  vpricem031,
  vpricem032,
  vpricem033,
  vpricem034,
  vpricem035,
  vpricem036,
  vpricem037,
  vpricem038,
  vpricem039,
  vpricem040,
  vpricem041,
  vpricem042,
  vpricem043,
  vpricem044,
  vpricem045,
  vpricem046,
  vpricem047,
  vpricem048,
  vpricem049,
  vpricem050,
  vpricem051,
  vpricem052,
  vpricem053,
  vpricem054,
  vpricem055,
  vpricem056,
  vpricem057,
  vpricem058,
  vpricem059,
  vpricem060,
  vpricem061,
  vpricem062,
  vpricem063,
  vpricem064,
  vpricem065,
  vpricem066,
  vpricem067,
  vpricem068,
  vpricem069,
  vpricem070,
  vpricem071,
  vpricem072,
  vpricem073,
  vpricem074,
  vpricem075,
  vpricem076,
  vpricem077,
  vpricem078,
  vpricem079,
  vpricem080,
  vpricem081,
  vpricem082,
  vpricem083,
  vpricem084,
  vpricem085,
  vpricem086,
  vpricem087,
  vpricem088,
  vpricem089,
  vpricem090,
  vpricem091,
  vpricem092,
  vpricem093,
  vpricem094,
  vpricem095,
  vpricem096,
  vpricem097,
  vpricem098,
  vpricem099,
  vpricem100,
  vpricem101,
  vpricem102,
  vpricem103,
  vpricem104,
  vpricem105,
  vpricem106,
  vpricem107,
  vpricem108,
  vpricem109,
  vpricem110,
  vpricem111,
  vpricem112,
  vpricem113,
  vpricem114,
  vpricem115,
  vpricem116,
  vpricem117,
  vpricem118,
  vpricem119
FROM
(SELECT 
  ci.vind3dig AS secid, 
  ci.vindustry as indname,
  median(pp.vpricem001) as vpricem001,
  median(pp.vpricem002) as vpricem002,
  median(pp.vpricem003) as vpricem003,
  median(pp.vpricem004) as vpricem004,
  median(pp.vpricem005) as vpricem005,
  median(pp.vpricem006) as vpricem006,
  median(pp.vpricem007) as vpricem007,
  median(pp.vpricem008) as vpricem008,
  median(pp.vpricem009) as vpricem009,
  median(pp.vpricem010) as vpricem010,
  median(pp.vpricem011) as vpricem011,
  median(pp.vpricem012) as vpricem012,
  median(pp.vpricem013) as vpricem013,
  median(pp.vpricem014) as vpricem014,
  median(pp.vpricem015) as vpricem015,
  median(pp.vpricem016) as vpricem016,
  median(pp.vpricem017) as vpricem017,
  median(pp.vpricem018) as vpricem018,
  median(pp.vpricem019) as vpricem019,
  median(pp.vpricem020) as vpricem020,
  median(pp.vpricem021) as vpricem021,
  median(pp.vpricem022) as vpricem022,
  median(pp.vpricem023) as vpricem023,
  median(pp.vpricem024) as vpricem024,
  median(pp.vpricem025) as vpricem025,
  median(pp.vpricem026) as vpricem026,
  median(pp.vpricem027) as vpricem027,
  median(pp.vpricem028) as vpricem028,
  median(pp.vpricem029) as vpricem029,
  median(pp.vpricem030) as vpricem030,
  median(pp.vpricem031) as vpricem031,
  median(pp.vpricem032) as vpricem032,
  median(pp.vpricem033) as vpricem033,
  median(pp.vpricem034) as vpricem034,
  median(pp.vpricem035) as vpricem035,
  median(pp.vpricem036) as vpricem036,
  median(pp.vpricem037) as vpricem037,
  median(pp.vpricem038) as vpricem038,
  median(pp.vpricem039) as vpricem039,
  median(pp.vpricem040) as vpricem040,
  median(pp.vpricem041) as vpricem041,
  median(pp.vpricem042) as vpricem042,
  median(pp.vpricem043) as vpricem043,
  median(pp.vpricem044) as vpricem044,
  median(pp.vpricem045) as vpricem045,
  median(pp.vpricem046) as vpricem046,
  median(pp.vpricem047) as vpricem047,
  median(pp.vpricem048) as vpricem048,
  median(pp.vpricem049) as vpricem049,
  median(pp.vpricem050) as vpricem050,
  median(pp.vpricem051) as vpricem051,
  median(pp.vpricem052) as vpricem052,
  median(pp.vpricem053) as vpricem053,
  median(pp.vpricem054) as vpricem054,
  median(pp.vpricem055) as vpricem055,
  median(pp.vpricem056) as vpricem056,
  median(pp.vpricem057) as vpricem057,
  median(pp.vpricem058) as vpricem058,
  median(pp.vpricem059) as vpricem059,
  median(pp.vpricem060) as vpricem060,
  median(pp.vpricem061) as vpricem061,
  median(pp.vpricem062) as vpricem062,
  median(pp.vpricem063) as vpricem063,
  median(pp.vpricem064) as vpricem064,
  median(pp.vpricem065) as vpricem065,
  median(pp.vpricem066) as vpricem066,
  median(pp.vpricem067) as vpricem067,
  median(pp.vpricem068) as vpricem068,
  median(pp.vpricem069) as vpricem069,
  median(pp.vpricem070) as vpricem070,
  median(pp.vpricem071) as vpricem071,
  median(pp.vpricem072) as vpricem072,
  median(pp.vpricem073) as vpricem073,
  median(pp.vpricem074) as vpricem074,
  median(pp.vpricem075) as vpricem075,
  median(pp.vpricem076) as vpricem076,
  median(pp.vpricem077) as vpricem077,
  median(pp.vpricem078) as vpricem078,
  median(pp.vpricem079) as vpricem079,
  median(pp.vpricem080) as vpricem080,
  median(pp.vpricem081) as vpricem081,
  median(pp.vpricem082) as vpricem082,
  median(pp.vpricem083) as vpricem083,
  median(pp.vpricem084) as vpricem084,
  median(pp.vpricem085) as vpricem085,
  median(pp.vpricem086) as vpricem086,
  median(pp.vpricem087) as vpricem087,
  median(pp.vpricem088) as vpricem088,
  median(pp.vpricem089) as vpricem089,
  median(pp.vpricem090) as vpricem090,
  median(pp.vpricem091) as vpricem091,
  median(pp.vpricem092) as vpricem092,
  median(pp.vpricem093) as vpricem093,
  median(pp.vpricem094) as vpricem094,
  median(pp.vpricem095) as vpricem095,
  median(pp.vpricem096) as vpricem096,
  median(pp.vpricem097) as vpricem097,
  median(pp.vpricem098) as vpricem098,
  median(pp.vpricem099) as vpricem099,
  median(pp.vpricem100) as vpricem100,
  median(pp.vpricem101) as vpricem101,
  median(pp.vpricem102) as vpricem102,
  median(pp.vpricem103) as vpricem103,
  median(pp.vpricem104) as vpricem104,
  median(pp.vpricem105) as vpricem105,
  median(pp.vpricem106) as vpricem106,
  median(pp.vpricem107) as vpricem107,
  median(pp.vpricem108) as vpricem108,
  median(pp.vpricem109) as vpricem109,
  median(pp.vpricem110) as vpricem110,
  median(pp.vpricem111) as vpricem111,
  median(pp.vpricem112) as vpricem112,
  median(pp.vpricem113) as vpricem113,
  median(pp.vpricem114) as vpricem114,
  median(pp.vpricem115) as vpricem115,
  median(pp.vpricem116) as vpricem116,
  median(pp.vpricem117) as vpricem117,
  median(pp.vpricem118) as vpricem118,
  median(pp.vpricem119) AS vpricem119
FROM mon_price_perc_vw pp 
JOIN si_ci_tab_plus_vw ci ON pp.vcompanyid = ci.vcompanyid
WHERE ci.vind3dig IN 
  (0103, 0106, 0109, 0112, 0115, 0118, 0121, 0124, 0127, 
  0130, 0133, 0203, 0206, 0209, 0212, 0215, 0218, 0221, 
  0303, 0403, 0406, 0409, 0412, 0415, 0418, 0421, 0424, 
  0427, 0430, 0433, 0436, 0503, 0506, 0509, 0512, 0515, 
  0518, 0521, 0524, 0603, 0606, 0609, 0612, 0703, 0706, 
  0709, 0712, 0715, 0718, 0721, 0724, 0727, 0730, 0803, 
  0806, 0809, 0812, 0903, 0906, 0909, 0912, 0915, 0918, 
  0921, 0924, 0927, 0930, 0933, 0936, 0939, 0942, 0945, 
  0948, 0951, 0954, 0957, 0960, 0963, 0966, 0969, 0972, 
  0975, 1003, 1006, 1012, 1015, 1018, 1021, 1024, 1027, 
  1030, 1033, 1036, 1103, 1106, 1109, 1112, 1115, 1118, 
  1203, 1206, 1209)
GROUP BY ci.vind3dig, ci.vindustry
UNION
SELECT 
  ci.vind2dig AS secid, 
  ci.vsector as indname,
  median(pp.vpricem001) as vpricem001,
  median(pp.vpricem002) as vpricem002,
  median(pp.vpricem003) as vpricem003,
  median(pp.vpricem004) as vpricem004,
  median(pp.vpricem005) as vpricem005,
  median(pp.vpricem006) as vpricem006,
  median(pp.vpricem007) as vpricem007,
  median(pp.vpricem008) as vpricem008,
  median(pp.vpricem009) as vpricem009,
  median(pp.vpricem010) as vpricem010,
  median(pp.vpricem011) as vpricem011,
  median(pp.vpricem012) as vpricem012,
  median(pp.vpricem013) as vpricem013,
  median(pp.vpricem014) as vpricem014,
  median(pp.vpricem015) as vpricem015,
  median(pp.vpricem016) as vpricem016,
  median(pp.vpricem017) as vpricem017,
  median(pp.vpricem018) as vpricem018,
  median(pp.vpricem019) as vpricem019,
  median(pp.vpricem020) as vpricem020,
  median(pp.vpricem021) as vpricem021,
  median(pp.vpricem022) as vpricem022,
  median(pp.vpricem023) as vpricem023,
  median(pp.vpricem024) as vpricem024,
  median(pp.vpricem025) as vpricem025,
  median(pp.vpricem026) as vpricem026,
  median(pp.vpricem027) as vpricem027,
  median(pp.vpricem028) as vpricem028,
  median(pp.vpricem029) as vpricem029,
  median(pp.vpricem030) as vpricem030,
  median(pp.vpricem031) as vpricem031,
  median(pp.vpricem032) as vpricem032,
  median(pp.vpricem033) as vpricem033,
  median(pp.vpricem034) as vpricem034,
  median(pp.vpricem035) as vpricem035,
  median(pp.vpricem036) as vpricem036,
  median(pp.vpricem037) as vpricem037,
  median(pp.vpricem038) as vpricem038,
  median(pp.vpricem039) as vpricem039,
  median(pp.vpricem040) as vpricem040,
  median(pp.vpricem041) as vpricem041,
  median(pp.vpricem042) as vpricem042,
  median(pp.vpricem043) as vpricem043,
  median(pp.vpricem044) as vpricem044,
  median(pp.vpricem045) as vpricem045,
  median(pp.vpricem046) as vpricem046,
  median(pp.vpricem047) as vpricem047,
  median(pp.vpricem048) as vpricem048,
  median(pp.vpricem049) as vpricem049,
  median(pp.vpricem050) as vpricem050,
  median(pp.vpricem051) as vpricem051,
  median(pp.vpricem052) as vpricem052,
  median(pp.vpricem053) as vpricem053,
  median(pp.vpricem054) as vpricem054,
  median(pp.vpricem055) as vpricem055,
  median(pp.vpricem056) as vpricem056,
  median(pp.vpricem057) as vpricem057,
  median(pp.vpricem058) as vpricem058,
  median(pp.vpricem059) as vpricem059,
  median(pp.vpricem060) as vpricem060,
  median(pp.vpricem061) as vpricem061,
  median(pp.vpricem062) as vpricem062,
  median(pp.vpricem063) as vpricem063,
  median(pp.vpricem064) as vpricem064,
  median(pp.vpricem065) as vpricem065,
  median(pp.vpricem066) as vpricem066,
  median(pp.vpricem067) as vpricem067,
  median(pp.vpricem068) as vpricem068,
  median(pp.vpricem069) as vpricem069,
  median(pp.vpricem070) as vpricem070,
  median(pp.vpricem071) as vpricem071,
  median(pp.vpricem072) as vpricem072,
  median(pp.vpricem073) as vpricem073,
  median(pp.vpricem074) as vpricem074,
  median(pp.vpricem075) as vpricem075,
  median(pp.vpricem076) as vpricem076,
  median(pp.vpricem077) as vpricem077,
  median(pp.vpricem078) as vpricem078,
  median(pp.vpricem079) as vpricem079,
  median(pp.vpricem080) as vpricem080,
  median(pp.vpricem081) as vpricem081,
  median(pp.vpricem082) as vpricem082,
  median(pp.vpricem083) as vpricem083,
  median(pp.vpricem084) as vpricem084,
  median(pp.vpricem085) as vpricem085,
  median(pp.vpricem086) as vpricem086,
  median(pp.vpricem087) as vpricem087,
  median(pp.vpricem088) as vpricem088,
  median(pp.vpricem089) as vpricem089,
  median(pp.vpricem090) as vpricem090,
  median(pp.vpricem091) as vpricem091,
  median(pp.vpricem092) as vpricem092,
  median(pp.vpricem093) as vpricem093,
  median(pp.vpricem094) as vpricem094,
  median(pp.vpricem095) as vpricem095,
  median(pp.vpricem096) as vpricem096,
  median(pp.vpricem097) as vpricem097,
  median(pp.vpricem098) as vpricem098,
  median(pp.vpricem099) as vpricem099,
  median(pp.vpricem100) as vpricem100,
  median(pp.vpricem101) as vpricem101,
  median(pp.vpricem102) as vpricem102,
  median(pp.vpricem103) as vpricem103,
  median(pp.vpricem104) as vpricem104,
  median(pp.vpricem105) as vpricem105,
  median(pp.vpricem106) as vpricem106,
  median(pp.vpricem107) as vpricem107,
  median(pp.vpricem108) as vpricem108,
  median(pp.vpricem109) as vpricem109,
  median(pp.vpricem110) as vpricem110,
  median(pp.vpricem111) as vpricem111,
  median(pp.vpricem112) as vpricem112,
  median(pp.vpricem113) as vpricem113,
  median(pp.vpricem114) as vpricem114,
  median(pp.vpricem115) as vpricem115,
  median(pp.vpricem116) as vpricem116,
  median(pp.vpricem117) as vpricem117,
  median(pp.vpricem118) as vpricem118,
  median(pp.vpricem119) AS vpricem119
FROM mon_price_perc_vw pp 
JOIN si_ci_tab_plus_vw ci ON pp.vcompanyid = ci.vcompanyid
WHERE ci.vind2dig IN (01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12)
GROUP BY ci.vind2dig, ci.vsector)
ORDER BY to_number(SECID);
